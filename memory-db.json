{"type":"entity","name":"eks-crossplane-atlas-cluster-context","entityType":"cluster-fingerprint","observations":["EKS cluster with Crossplane AWS provider v1beta3","Atlas operator in atlas-operator namespace for schema management","DevOpsToolkit application platform with App/AppClaim CRDs","Requires VPC with internet gateway for public RDS access","Cluster uses 192.168.x.x internal networking"]}
{"type":"entity","name":"aws-rds-crossplane-api-patterns","entityType":"api-reference","observations":["AWS RDS Instance v1beta3: use writeConnectionSecretToRef (singular, not plural)","PostgreSQL engine version: use '15' not '15.4' for AWS RDS compatibility","VPC references: use vpcSecurityGroupIdRefs and dbSubnetGroupNameRef","Internet Gateway: attach directly to VPC using vpcIdRef in IGW spec","Required VPC infrastructure: VPC, IGW, Subnets, Security Group, Route Table with 0.0.0.0/0 route"]}
{"type":"entity","name":"atlas-schema-connection-patterns","entityType":"configuration-pattern","observations":["Atlas credentials: use 'host' key from connection secret, NOT 'endpoint' (avoids :5432:5432 error)","Connection secret keys: host, username, password, port (separate fields)","Policy settings: set destructive.error=false and skip modify_schema=true for permissive deployment","txMode: use 'none' for PostgreSQL compatibility"]}
{"type":"entity","name":"database-deployment-prevention-checklist","entityType":"prevention-guide","observations":["CRITICAL: Ensure database is completely clean before Atlas schema deployment","Remove any manually created tables/data that could cause schema state mismatch","Verify DNS resolution from cluster pods to external RDS endpoints","Test TCP connectivity (port 5432) before deploying Atlas schema","Always restart Atlas operator pod if connection issues persist"]}
{"type":"entity","name":"successful-rds-atlas-workflow","entityType":"deployment-sequence","observations":["1. Deploy VPC infrastructure: VPC → IGW → Subnets → Security Group → Route Table","2. Deploy RDS instance with proper VPC references and public access","3. Wait for RDS READY=True status (~5-10 minutes)","4. Verify database connectivity and ensure clean state (no existing tables)","5. Deploy Atlas schema with correct connection configuration","6. Monitor Atlas deployment: GettingDevDB → VerifyingFirstRun → Applied"]}
{"type":"entity","name":"common-database-issues-resolutions","entityType":"troubleshooting-guide","observations":["VPC Error 'no internet gateway': Create IGW with vpcIdRef and route table with 0.0.0.0/0 route","Atlas ':5432:5432' error: Use 'host' key instead of 'endpoint' from connection secret","Atlas schema state mismatch: Clean database of any manual tables/data before deployment","PostgreSQL version not found: Use supported versions like '15' instead of '15.4'","Atlas DNS resolution failed: Restart Atlas operator pod and verify cluster networking"]}
{"type":"entity","name":"eks-crossplane-deletion-prevention","entityType":"prevention-guide","observations":["CRITICAL: Delete Atlas schema before RDS instance to avoid orphaned schema references","Always use YAML manifests for DevOpsToolkit platform - label-based deletion misses composed resources","VPC infrastructure can be deleted immediately after RDS - no dependency wait needed","If RDS deletion hangs: Check AWS console for deletion protection or backup retention","Stuck VPC deletion usually means RDS still has ENI attachments"]}