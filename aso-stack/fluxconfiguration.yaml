apiVersion: kubernetesconfiguration.azure.com/v1api20241101
kind: FluxConfiguration
metadata:
  name: aso-flux
  namespace: azure-system
spec:
  azureName: aso-flux
  gitRepository:
    provider: Generic
    repositoryRef:
      branch: test-cluster-build
    url: https://github.com/davidmarkgardiner/claude-aso
  kustomizations:
    external-dns:
      path: ./apps/external-dns
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: external-dns-identity-cm
            optional: false
    cert-manager:
      path: ./apps/cert-manager
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: cert-manager-identity-cm
            optional: false
    apps:
      dependsOn: ["external-dns", "cert-manager"]
      path: ./apps
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
    istio-app:
      dependsOn: ["apps"]
      path: ./istio-apps
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
  namespace: azure-system
  owner:
    group: containerservice.azure.com
    kind: ManagedCluster
    name: uk8s-tsshared-weu-gt025-int-prod
  sourceKind: GitRepository