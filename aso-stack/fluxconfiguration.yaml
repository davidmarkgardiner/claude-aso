apiVersion: kubernetesconfiguration.azure.com/v1api20241101
kind: FluxConfiguration
metadata:
  name: aso-flux
  namespace: azure-system
spec:
  azureName: aso-flux
  gitRepository:
    provider: Generic
    repositoryRef:
      branch: feature/external-secrets
    url: https://github.com/davidmarkgardiner/claude-aso
  kustomizations:
    external-dns:
      path: ./apps/external-dns
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: external-dns-identity-cm
    cert-manager-base:
      path: ./apps/cert-manager-base
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: cert-manager-identity-cm
    cert-manager-config:
      dependsOn: ["cert-manager-base"]
      path: ./apps/cert-manager-config
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: cert-manager-identity-cm
    # istio-apps:
    #   dependsOn: ["external-dns", "cert-manager-config"]
    #   path: ./istio-apps
    #   timeoutInSeconds: 600
    #   syncIntervalInSeconds: 120
    #   prune: true
    #   force: true
    apps:
      dependsOn: ["external-dns", "cert-manager-config"]
      path: ./apps
      timeoutInSeconds: 600
      syncIntervalInSeconds: 120
      prune: true
      force: true
      postBuild:
        substituteFrom:
          - kind: ConfigMap
            name: platform-api-identity-cm
  namespace: azure-system
  owner:
    group: containerservice.azure.com
    kind: ManagedCluster
    name: uk8s-tsshared-weu-gt025-int-prod
  sourceKind: GitRepository
